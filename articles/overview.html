<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of the occupancy package • occupancy</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of the occupancy package">
<meta property="og:description" content="occupancy">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">occupancy</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/overview.html">Getting started</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/reconhub/occupancy">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="overview_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview of the occupancy package</h1>
                        <h4 class="author">Tim Taylor</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/reconhub/occupancy/blob/master/vignettes/overview.Rmd"><code>vignettes/overview.Rmd</code></a></small>
      <div class="hidden name"><code>overview.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>occupancy</code> implements forecasting of daily bed occupancy using input data on both daily hospital admissions and the density distribution for the duration of stay. It aims to provide a reliable and standardised approach to forecasting that will help improve the quality and ease of provision of predictions.</p>
<div id="available-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#available-functions" class="anchor"></a>Available functions</h2>
<p><code>occupancy</code> contains three functions:</p>
<ul>
<li>
<code>project_beds</code> is the main function to compute projections of bed occupancy from admissions data and a length of stay distribution.</li>
<li>
<code>build_projections</code> is reexported from the <a href="https://cran.r-project.org/web/packages/projections/index.html"><code>projections</code></a> package. It allows the user to build a  object that can be fed to the <code>project_beds</code> function.</li>
<li>
<code>incidence</code> is reexported from the <a href="https://cran.r-project.org/web/packages/incidence/index.html"><code>incidence</code></a> package. Similarly to the <code>build_projections</code> function above, it allows the user to build a  object that can be fed to <code>project_beds</code>.</li>
</ul>
</div>
</div>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">occupancy</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)    <span class="co"># for plotting</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scales</span>)     <span class="co"># for plotting</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">distcrete</span>)  <span class="co"># for disretisation</span></pre></body></html></div>
<p>We consider two examples where we have hospital admission data and our goal is to predict bed occupancy for the following weeks. With both examples we will consider an outbreak in it’s early stages, where we anticipate exponential growth in the number of cases.</p>
<p>Both examples will use a <a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull distribution</a> for length of stay and the <a href="https://cran.r-project.org/web/packages/distcrete/index.html"><code>distcrete</code></a> package to discretise the distribution.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">length_of_stay</span> <span class="kw">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/distcrete/man/distcrete.html">distcrete</a></span>(<span class="st">"weibull"</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1.1</span>, <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">7.4</span>, <span class="kw">w</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">interval</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>In this example we assume the disease has a doubling time of 7 days and that there are initially 10 hospital admissions.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">initial_admissions</span> <span class="kw">&lt;-</span> <span class="fl">10</span> <span class="co"># day one</span>
<span class="no">duration</span> <span class="kw">&lt;-</span> <span class="fl">14</span>           <span class="co"># 14 days (2 weeks) duration</span>
<span class="no">growth_rate</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">2</span>) / <span class="fl">7</span> <span class="co"># doubling time of 7 days</span>

<span class="no">future_admissions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(
    <span class="no">initial_admissions</span> * <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="no">growth_rate</span> * (<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="no">duration</span>))))

<span class="no">admissions</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/incidence.html">incidence</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>() + <span class="fl">0</span>:<span class="fl">14</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">initial_admissions</span>, <span class="no">future_admissions</span>)))

<span class="co"># convert to a projections object to use with the project_beds function</span>
<span class="no">admissions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/build_projections.html">build_projections</a></span>(
    <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">initial_admissions</span>, <span class="no">future_admissions</span>),
    <span class="kw">dates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>() + <span class="fl">0</span>:<span class="fl">14</span>)</pre></body></html></div>
<p>We now have all the variables we need to make our forecast of bed occupancy</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">projection</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_beds.html">project_beds</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">admissions</span>,
                           <span class="kw">r_los</span> <span class="kw">=</span> <span class="no">length_of_stay</span>,
                           <span class="kw">n_sims</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">projection</span>, <span class="kw">quantiles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>), <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Predicted occupancy"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://scales.r-lib.org//reference/breaks_pretty.html">breaks_pretty</a></span>(<span class="fl">10</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">500</span>)
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which will</span>
<span class="co">#&gt; replace the existing scale.</span></pre></body></html></div>
<p><img src="overview_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>In this example we assume we have a weeks worth of admission data that, again, we want to forecast the next 14 days. This time, however, we would like to encorporate the <a href="https://en.wikipedia.org/wiki/Serial_interval">serial-interval</a> of the disease as well as an estimation of <a href="https://en.wikipedia.org/wiki/Basic_reproduction_number">R0</a>.</p>
<p>To start with we make up some toy admissions data and create a discretised serial interval. To give the example some some grounding in reality we use some reasearch from the recent COVID-19 pandemic. In a small <a href="https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext">study</a> it was observed that a log-normal distribution provided a good fit for data that had an observed mean of 4.7 days and standard deviation of 2.9 days. In what follows we use a value of R0 = 2.5.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">projections</span>)  <span class="co"># so we can use the `project` and subset functions </span>

<span class="co"># make some fake admissions data</span>
<span class="no">initial_admissions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>() - <span class="fl">0</span>:<span class="fl">7</span>, <span class="fl">30</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">initial_admissions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/incidence.html">incidence</a></span>(<span class="no">initial_admissions</span>)

<span class="co"># observed study values need converting before use with R's log-normal function</span>
<span class="no">recorded_mean</span> <span class="kw">&lt;-</span> <span class="fl">4.7</span>
<span class="no">recorded_sd</span> <span class="kw">&lt;-</span> <span class="fl">2.9</span>
<span class="no">mu</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">recorded_mean</span>^<span class="fl">2</span> / <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">recorded_mean</span>^<span class="fl">2</span> + <span class="no">recorded_sd</span>^<span class="fl">2</span>))
<span class="no">sd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">1</span> + <span class="no">recorded_sd</span>^<span class="fl">2</span> / <span class="no">recorded_mean</span>^<span class="fl">2</span>))

<span class="co"># generate the discretised serial inteval</span>
<span class="no">serial_interval</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/distcrete/man/distcrete.html">distcrete</a></span>(<span class="st">"lnorm"</span>, <span class="no">mu</span>, <span class="no">sd</span>, <span class="kw">w</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">interval</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">1</span>:<span class="fl">20</span>, <span class="no">serial_interval</span>$<span class="fu">d</span>(<span class="fl">1</span>:<span class="fl">20</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"h"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"navy"</span>,
     <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Serial interval"</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Days after onset"</span>,
     <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Relative infectiousness"</span>)</pre></body></html></div>
<p><img src="overview_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="co"># project future admissions</span>
<span class="no">future_admissions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/projections/man/project.html">project</a></span>(<span class="no">initial_admissions</span>,
                             <span class="kw">R</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">2.5</span>), <span class="kw">si</span> <span class="kw">=</span> <span class="no">serial_interval</span>,
                             <span class="kw">n_days</span> <span class="kw">=</span> <span class="fl">14</span>, <span class="kw">n_sim</span> <span class="kw">=</span> <span class="fl">100</span>)

<span class="co"># combine the current and future admissions data</span>
<span class="no">original_admissions</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/build_projections.html">build_projections</a></span>(<span class="no">initial_admissions</span>$<span class="no">counts</span>,
                                        <span class="no">initial_admissions</span>$<span class="no">dates</span>)
<span class="no">admissions</span> <span class="kw">&lt;-</span> <span class="no">future_admissions</span> + <span class="no">original_admissions</span></pre></body></html></div>
<p>Now we can again make our forecasts</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">projections</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/project_beds.html">project_beds</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">admissions</span>,
                           <span class="kw">r_los</span> <span class="kw">=</span> <span class="no">length_of_stay</span>,
                           <span class="kw">n_sims</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="no">projections</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="no">projections</span>, <span class="kw">from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>())

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">projections</span>, <span class="kw">quantiles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>), <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Predicted occupancy"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://scales.r-lib.org//reference/breaks_pretty.html">breaks_pretty</a></span>(<span class="fl">10</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fl">0</span>, <span class="fl">500</span>)
<span class="co">#&gt; Scale for 'x' is already present. Adding another scale for 'x', which will</span>
<span class="co">#&gt; replace the existing scale.</span></pre></body></html></div>
<p><img src="overview_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thibaut Jombart, Taylor Tim.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
